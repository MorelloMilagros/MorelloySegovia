<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lista de Reclamos</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Reclamos Disponibles</h1>

        <!-- Mensajes de error / éxito -->
        {% with mensajes = get_flashed_messages(with_categories=true) %}
          {% if mensajes %}
            {% for categoria, mensaje in mensajes %}
              <div class="alert alert-{{ categoria }}">{{ mensaje }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- Filtro por departamento -->
        <form method="GET" action="{{ url_for('listar_reclamos') }}" class="filter-form">
            <label for="departamento">Filtrar por departamento:</label>
            <select name="departamento" class="form-control">
                <option value="">Todos</option>
                {% for depto in departamentos %}
                    <option value="{{ depto }}" {% if departamento_filtro == depto %}selected{% endif %}>{{ depto }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn-filter">Filtrar</button>
        </form>

        <!-- Tabla con reclamos -->
        {% if lista_reclamos %}
            <table class="styled-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Descripción</th>
                        <th>Estado</th>
                        <th>Fecha</th>
                        <th>Departamento</th>
                        <th>Adherentes</th>
                        <th>Foto</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reclamo in lista_reclamos %}
                    <tr>
                        <td>{{ reclamo.id }}</td>
                        <td>{{ reclamo.descripcion }}</td>
                        <td><span class="status {{ reclamo.estado }}">{{ reclamo.estado }}</span></td>
                        <td>{{ reclamo.fecha_creacion.strftime('%d/%m/%Y') }}</td>
                        <td>{{ reclamo.departamento }}</td>
                        <td>{{ reclamo.adherentes }}</td>
                        <td>
                            {% if reclamo.foto %}
                              <img src="{{ url_for('static', filename='uploads/' + reclamo.foto) }}" alt="Foto del reclamo" width="100">
                            {% else %}
                              <p>No hay foto disponible.</p>
                            {% endif %}
                        </td>
                        <td>
                            <form action="{{ url_for('adherirse') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="id_reclamo" value="{{ reclamo.id }}">
                                <button type="submit" class="btn-join">Adherirse</button>
                            </form>

                            {% if current_user.es_jefe() or current_user.es_secretario() or current_user.es_tecnico() %}
                                <a href="{{ url_for('editar_reclamo', id=reclamo.id) }}" class="btn-edit">✏ Editar</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No hay reclamos disponibles en este departamento.</p>
        {% endif %}

        <div class="button-container">
            <a href="{{ url_for('agregar_reclamo') }}" class="btn-add">Agregar nuevo reclamo</a>
            <a href="{{ url_for('dashboard') }}" class="btn-back">Volver al Dashboard</a>
        </div>
    </div>
</body>
</html>
