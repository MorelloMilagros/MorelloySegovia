<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administración - {{ current_user.departamento }}</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Panel de Administración - {{ current_user.departamento }}</h1>
        <p>Bienvenido, {{ current_user.nombre }} ({{ current_user.rol }})</p>

        <!-- Opciones del Dashboard -->
        <div class="button-container">
            <a href="{{ url_for('analitica') }}" class="btn-primary">Analítica</a>
            <a href="{{ url_for('ayuda') }}" class="btn-secondary"> Ayuda</a>
            <a href="{{ url_for('agregar_reclamo') }}" class="btn-info">Generar Reporte</a>
            <a href="{{ url_for('logout') }}" class="btn-logout">Cerrar sesión</a>
        </div>

        <h2> Reclamos del Departamento</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Descripción</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                    <th>Adherentes</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for reclamo in lista_reclamos %}
                <tr>
                    <td>{{ reclamo.id }}</td>
                    <td>{{ reclamo.descripcion }}</td>
                    <td><span class="status {{ reclamo.estado }}">{{ reclamo.estado }}</span></td>
                    <td>{{ reclamo.fecha_creacion.strftime('%d/%m/%Y') }}</td>
                    <td>{{ reclamo.adherentes }}</td>
                    <td>
                        <!-- Formulario para actualizar estado -->
                        <form action="{{ url_for('editar_reclamo', id=reclamo.id) }}" method="GET" style="display:inline;">
                            <button type="submit" class="btn-edit">Editar Reclamo</button>
                        </form>

                        <!-- Opción exclusiva para Secretaría Técnica -->
                        {% if current_user.es_secretario() %}
                            <form action="{{ url_for('derivar_reclamo', id=reclamo.id) }}" method="POST" style="display:inline;">
                                <button type="submit" class="btn-transfer"> Derivar</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Estadísticas del Departamento</h2>
        <p><strong>Reclamos pendientes:</strong> {{ stats.pendientes }}</p>
        <p><strong>Reclamos en proceso:</strong> {{ stats.en_proceso }}</p>
        <p><strong>Reclamos resueltos:</strong> {{ stats.resueltos }}</p>

        <h3>Tiempo medio de resolución</h3>
        <p><strong>Mediana en proceso:</strong> {{ stats.mediana_en_proceso if stats.mediana_en_proceso else "No disponible" }}</p>
        <p><strong>Mediana resueltos:</strong> {{ stats.mediana_resueltos if stats.mediana_resueltos else "No disponible" }}</p>
    </div>
</body>
</html>
